{
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "994d1f7c-a2b3-479d-824b-eb2b99e7df73",
                    "leftValue": "={{ $json.chatInput }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "fcb767ee-565e-4b56-a54e-6f97f739fc24",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.chatInput }}",
                    "rightValue": ""
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": false,
          "allMatchingOutputs": true
        }
      },
      "id": "390082c4-c014-462c-ba21-bc42fe31dc96",
      "name": "Input Message Router1",
      "type": "n8n-nodes-base.switch",
      "position": [
        1776,
        672
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "=You are a Nutrition Vision Assistant. Think like a food scientist and registered dietitian. Reason silently and do not reveal your steps. From a single food photo, identify the meal components, estimate portion weight in grams per component using geometric/visual cues, then compute total calories, protein, carbs, and fat.\n\nEstimation method (internal only; do not output these steps)\n\nIdentify components: list the main foods (e.g., chicken breast, white rice, mixed salad, sauce).\n\nChoose references: map each component to a standard reference food.\n\nEstimate volume/size: use visible objects for scale (plate â‰ˆ 27 cm diameter, fork tines â‰ˆ 3.5 cm, spoon bowl â‰ˆ 5â€“6 cm). Approximate shapes (cuboid, cylinder, dome) to get volume in ml (â‰ˆ cmÂ³).\n\nConvert to grams (densities, g/ml): meats 1.05; cooked rice 0.66; cooked pasta 0.60; potato/solid starchy veg 0.80; leafy salad 0.15; sauces creamy 1.00; oils 0.91. If the image clearly suggests deep-fried or glossy/oily coating, account for added oil.\n\nMacros & energy per 100 g (reference values):\n\nWhite rice, cooked: 130 kcal, P 2.7, C 28, F 0.3\n\nPasta, cooked: 131 kcal, P 5.0, C 25, F 1.1\n\nChicken breast, cooked skinless: 165 kcal, P 31, C 0, F 3.6\n\nSalmon, cooked: 208 kcal, P 20, C 0, F 13\n\nLean ground beef (â‰ˆ10% fat), cooked: 217 kcal, P 26, C 0, F 12\n\nBlack beans, cooked: 132 kcal, P 8.9, C 23.7, F 0.5\n\nPotato, baked: 93 kcal, P 2.5, C 21, F 0.1\n\nLettuce/leafy salad: 15 kcal, P 1.4, C 2.9, F 0.2\n\nAvocado: 160 kcal, P 2, C 9, F 15\n\nBread (white): 265 kcal, P 9, C 49, F 3.2\n\nEgg, cooked: 155 kcal, P 13, C 1.1, F 11\n\nCheddar cheese: 403 kcal, P 25, C 1.3, F 33\n\nOlive oil: 884 kcal, P 0, C 0, F 100\n(If a food is not listed, pick the closest standard equivalent.)\n\nHidden oil & sauces: if pan-fried or visibly glossy, add ~1 tablespoon oil = 13.5 g = 120 kcal = 13.5 g fat per clearly coated serving; adjust by visual coverage.\n\nSum totals: compute grams per component Ã— (per-100 g macros/energy) and add all components.\n\nValidation: enforce Calories â‰ˆ 4Ã—Protein + 4Ã—Carbs + 9Ã—Fat. If off by >8%, adjust fat first (oil/sauce most variable), then carbs (starches), keeping protein consistent with visible lean mass.\n\nRounding: round all final totals to integers. Never output ranges or decimals.\n\nOutput rules (must follow exactly)\n\nPlain text only.\n\nUse this exact structure and field order.\n\nValues are numbers only (no units, no â€œgâ€ or â€œkcalâ€), no extra text, no JSON, no notes.\nfood name :[name]\nMeal Description: [short description]\nCalories: [number]\nProteins: [number]\nCarbs: [number]\nFat: [number]\nfood name è«‹ä½¿ç”¨ä¸­æ–‡ä¾†ç¨±å‘¼",
        "inputType": "binary",
        "options": {}
      },
      "id": "20396779-7581-4957-ab7e-ba2e0eee44a9",
      "name": "Analyze image",
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "position": [
        2240,
        880
      ],
      "typeVersion": 1,
      "credentials": {},
      "disabled": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-3-pro-preview",
        "options": {}
      },
      "id": "9a348a9d-2740-46c1-abe2-cb5d205840e2",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        3904,
        1008
      ],
      "typeVersion": 1,
      "credentials": {}
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=updateProfileData\nPurpose: Update the userâ€™s profile targets.\nFields that can be updated:\n\nName (string)\n\nCalories_target (string/number)\n\nProtein_target (string/number)\nWhen to use: When the user explicitly asks to update their name, calorie target, or protein target.",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Dm_PA5AUHaFe4qatsKmBBfLpuxUPLw8xHlNd8Tv9Wpw/edit#gid=0",
          "cachedResultName": "Profile"
        },
        "columns": {
          "value": {
            "Name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name', ``, 'string') }}",
            "User_ID": "={{ $json.chat_id }}",
            "Protein_target": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Protein_target', ``, 'string') }}",
            "Calories_target": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calories_target', ``, 'string') }}"
          },
          "schema": [
            {
              "id": "User_ID",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "User_ID",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Calories_target",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Calories_target",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Protein_target",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Protein_target",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "User_ID"
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "5bf67d24-1c4c-4015-818b-f60145cce737",
      "name": "Update Profile Data",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        5088,
        1120
      ],
      "typeVersion": 4.7,
      "credentials": {},
      "disabled": true
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=getUserData\nPurpose: Retrieve the userâ€™s profile information.\nInputs: none.\nWhen to use: When the user asks about their profile info or targets.",
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Dm_PA5AUHaFe4qatsKmBBfLpuxUPLw8xHlNd8Tv9Wpw/edit#gid=0",
          "cachedResultName": "Profile"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "User_ID",
              "lookupValue": "={{ $json.chat_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "4d0062a0-b3c8-4c5b-9e9f-f461a3fccf96",
      "name": "Get Profile Data",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        4960,
        1120
      ],
      "typeVersion": 4.7,
      "credentials": {},
      "disabled": true
    },
    {
      "parameters": {
        "description": "getReport\nPurpose: Generate or fetch the userâ€™s daily nutrition report.\nInput required: date (string, format: YYYY-MM-DD).\nWhen to use: When the user asks to see their daily summary or report for a specific date.",
        "workflowId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $workflow.id }}"
        },
        "workflowInputs": {
          "value": {
            "Date": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Date', ``, 'string') }}",
            "User_ID": "={{ $json.chat_id }}"
          },
          "schema": [
            {
              "id": "User_ID",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "User_ID",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Date",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "id": "e68b4eb2-4cef-4e49-bcb3-5f0f01e8366b",
      "name": "Get Report",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        4240,
        1296
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "appendMealData\nPurpose: Store one meal entry into the Meals sheet.\nInputs required:\n\nMeal Description (string)\n\nCalories (number)\n\nProteins (number)\n\nCarbs (number)\n\nFat (number)\nWhen to use: Every time you receive structured meal information from image analysis.",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 159746800,
          "mode": "list",
          "cachedResultName": "Meals",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit#gid=159746800"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "123",
            "date": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('date', ``, 'string') }}",
            "meal_description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('meal_description', ``, 'string') }}",
            "calories": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('calories', ``, 'string') }}",
            "proteins": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('proteins', ``, 'string') }}",
            "carbs": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('carbs', ``, 'string') }}",
            "fats": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fats', ``, 'string') }}",
            "other": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('other', ``, 'string') }}",
            "all_nutrients_json": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('all_nutrients_json', `all_nutrients_json sum`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "meal_description",
              "displayName": "meal_description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "calories",
              "displayName": "calories",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "proteins",
              "displayName": "proteins",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "carbs",
              "displayName": "carbs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fats",
              "displayName": "fats",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "other",
              "displayName": "other",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "all_nutrients_json",
              "displayName": "all_nutrients_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "b17d593a-3ab6-4cbd-b9dd-def58d7567f9",
      "name": "Append Meal Data",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        4720,
        1184
      ],
      "typeVersion": 4.7,
      "credentials": {}
    },
    {
      "parameters": {
        "content": "",
        "height": 560,
        "width": 768,
        "color": 4
      },
      "id": "722f01b2-deb0-47d9-8465-454e8a8c4020",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1232,
        400
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "content": "",
        "height": 608,
        "width": 1680,
        "color": 5
      },
      "id": "317ca7d0-a8a1-4bb8-9f70-63bbb9030356",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2032,
        880
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "content": "",
        "height": 784,
        "width": 1520,
        "color": 6
      },
      "id": "f2789f23-e038-4584-b423-e3579c4c5a48",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3760,
        688
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "public": true,
        "authentication": "basicAuth",
        "initialMessages": "Hi é€™æ˜¯114 ç‰©è¯ç¶²çš„æœŸæœ«å°ˆé¡Œç¯„ä¾‹! ğŸ‘‹\næˆ‘æ˜¯æ‚¨çš„å¥åº·åŠ©ç† . ä»Šå¤©æœ‰ç”šéº¼å¯ä»¥å”åŠ©ä½ çš„?",
        "options": {
          "allowFileUploads": true,
          "allowedFilesMimeTypes": "image/*",
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        1344,
        448
      ],
      "id": "f7259f0a-d66e-4b25-9d07-7f092e177936",
      "name": "When chat message received",
      "webhookId": "08e0f52e-c502-4d05-8eae-4ffc6f77b363",
      "alwaysOutputData": true,
      "credentials": {},
      "disabled": true
    },
    {
      "parameters": {
        "message": "= {{ $json.output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        5040,
        688
      ],
      "id": "a774ef07-441b-4afc-b045-a9e03664871c",
      "name": "Respond to Chat2",
      "disabled": true
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1808490457,
          "mode": "list",
          "cachedResultName": "ææ–™æ˜ç´°åƒè€ƒ",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit#gid=1808490457"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "name_zh",
              "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            },
            {
              "lookupColumn": "name_en",
              "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values1_Value', ``, 'string') }}"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        4496,
        1232
      ],
      "id": "3b6c7988-7bac-41e9-a57a-d751d455a32a",
      "name": "Get ingredients Info",
      "credentials": {}
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "e9919eb0-9661-4ca3-80da-2f1b611e98e3",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1296,
        768
      ],
      "id": "51c8ebf0-8f97-4c95-b4a9-d600d1954572",
      "name": "Webhook",
      "webhookId": "e9919eb0-9661-4ca3-80da-2f1b611e98e3"
    },
    {
      "parameters": {
        "jsCode": "// å–å¾—ç¬¬ä¸€å€‹é …ç›®\nconst item = items[0];\nlet chatInput = \"\";\n\n// --------------------------------------\n// 1. è™•ç†æ–‡å­—é‚è¼¯ (åˆä½µä½ åŸæœ¬çš„é‚è¼¯)\n// --------------------------------------\n\n// æª¢æŸ¥æ˜¯å¦æœ‰ body.text (ä¸€èˆ¬ JSON)\nif (item.json.body && item.json.body.text) {\n  chatInput = item.json.body.text;\n} \n// æª¢æŸ¥æ˜¯å¦æœ‰ binary.text (Multipart èª¤åˆ¤ç‚ºæª”æ¡ˆ)\nelse if (item.binary && item.binary.text) {\n  // å°‡ Binary Data (Base64) è½‰å›æ–‡å­—\n  chatInput = Buffer.from(item.binary.text.data, 'base64').toString('utf-8');\n}\n\n// --------------------------------------\n// 2. å¼·åˆ¶ä¿®æ­£åœ–ç‰‡ MIME Type (è§£æ±º OpenAI å ±éŒ¯çš„æ ¸å¿ƒ)\n// --------------------------------------\nif (item.binary) {\n  for (const key of Object.keys(item.binary)) {\n    // è·³é 'text' æ¬„ä½ï¼Œåªè™•ç†çœŸæ­£çš„æª”æ¡ˆ\n    if (key === 'text') continue;\n\n    const fileData = item.binary[key];\n    \n    // å¦‚æœ MIME Type æ˜¯æœªçŸ¥çš„ application/octet-streamï¼Œå°±æ ¹æ“šæª”åä¿®æ­£\n    if (fileData.mimeType === 'application/octet-stream' || !fileData.mimeType) {\n       const fileName = fileData.fileName ? fileData.fileName.toLowerCase() : '';\n\n       if (fileName.endsWith('.png')) {\n         item.binary[key].mimeType = 'image/png';\n         item.binary[key].fileExtension = 'png';\n       } else if (fileName.endsWith('.jpg') || fileName.endsWith('.jpeg')) {\n         item.binary[key].mimeType = 'image/jpeg';\n         item.binary[key].fileExtension = 'jpg';\n       } else if (fileName.endsWith('.webp')) {\n         item.binary[key].mimeType = 'image/webp';\n         item.binary[key].fileExtension = 'webp';\n       }\n    }\n  }\n}\n\n// --------------------------------------\n// 3. çµ±ä¸€å›å‚³çµæœ\n// --------------------------------------\nreturn [\n  {\n    json: {\n      chatInput: chatInput,\n      files: item.json.files // ä¿ç•™åŸæœ¬çš„ files è³‡è¨Š\n    },\n    // é€™è£¡å›å‚³çš„ binary å·²ç¶“æ˜¯è¢«ä¸Šé¢ç¨‹å¼ç¢¼ä¿®æ­£é MIME Type çš„ç‰ˆæœ¬\n    binary: item.binary \n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1520,
        768
      ],
      "id": "be815f84-d8f1-46ba-9d00-38cc87bf3a82",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "resource": "image",
        "modelId": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101",
          "mode": "list",
          "cachedResultName": "claude-opus-4-5-20251101"
        },
        "text": "You are a Nutrition Vision Assistant. Think like a food scientist and registered dietitian. Reason silently and do not reveal your steps. From a single food photo, identify the meal components, estimate portion weight in grams per component using geometric/visual cues, then compute total calories, protein, carbs, and fat.\n\nEstimation method (internal only; do not output these steps)\n\nIdentify components: list the main foods (e.g., chicken breast, white rice, mixed salad, sauce).\n\nChoose references: map each component to a standard reference food.\n\nEstimate volume/size: use visible objects for scale (plate â‰ˆ 27 cm diameter, fork tines â‰ˆ 3.5 cm, spoon bowl â‰ˆ 5â€“6 cm). Approximate shapes (cuboid, cylinder, dome) to get volume in ml (â‰ˆ cmÂ³).\n\nConvert to grams (densities, g/ml): meats 1.05; cooked rice 0.66; cooked pasta 0.60; potato/solid starchy veg 0.80; leafy salad 0.15; sauces creamy 1.00; oils 0.91. If the image clearly suggests deep-fried or glossy/oily coating, account for added oil.\n\nMacros & energy per 100 g (reference values):\n\nWhite rice, cooked: 130 kcal, P 2.7, C 28, F 0.3\n\nPasta, cooked: 131 kcal, P 5.0, C 25, F 1.1\n\nChicken breast, cooked skinless: 165 kcal, P 31, C 0, F 3.6\n\nSalmon, cooked: 208 kcal, P 20, C 0, F 13\n\nLean ground beef (â‰ˆ10% fat), cooked: 217 kcal, P 26, C 0, F 12\n\nBlack beans, cooked: 132 kcal, P 8.9, C 23.7, F 0.5\n\nPotato, baked: 93 kcal, P 2.5, C 21, F 0.1\n\nLettuce/leafy salad: 15 kcal, P 1.4, C 2.9, F 0.2\n\nAvocado: 160 kcal, P 2, C 9, F 15\n\nBread (white): 265 kcal, P 9, C 49, F 3.2\n\nEgg, cooked: 155 kcal, P 13, C 1.1, F 11\n\nCheddar cheese: 403 kcal, P 25, C 1.3, F 33\n\nOlive oil: 884 kcal, P 0, C 0, F 100\n(If a food is not listed, pick the closest standard equivalent.)\n\nHidden oil & sauces: if pan-fried or visibly glossy, add ~1 tablespoon oil = 13.5 g = 120 kcal = 13.5 g fat per clearly coated serving; adjust by visual coverage.\n\nSum totals: compute grams per component Ã— (per-100 g macros/energy) and add all components.\n\nValidation: enforce Calories â‰ˆ 4Ã—Protein + 4Ã—Carbs + 9Ã—Fat. If off by >8%, adjust fat first (oil/sauce most variable), then carbs (starches), keeping protein consistent with visible lean mass.\n\nRounding: round all final totals to integers. Never output ranges or decimals.\n\nOutput rules (must follow exactly)\n\nPlain text only.\n\nUse this exact structure and field order.\n\nValues are numbers only (no units, no â€œgâ€ or â€œkcalâ€), no extra text, no JSON, no notes.\nfood name :[name]\nMeal Description: [short description]\nCalories: [number]\nProteins: [number]\nCarbs: [number]\nFat: [number]\nfood name è«‹ä½¿ç”¨ä¸­æ–‡ä¾†ç¨±å‘¼",
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.anthropic",
      "typeVersion": 1,
      "position": [
        2240,
        1280
      ],
      "id": "9cf8db4d-64c8-48b9-845e-83e15ac1e972",
      "name": "Analyze image2",
      "credentials": {},
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æ•´åˆä»¥ä¸‹ä¸‰å€‹è¦–è¦ºè¾¨è­˜å…§å®¹,å½™æ•´èˆ‡çµ±æ•´å¹³å‡å„è‡ªå…§å®¹.\nç”¢å‡ºä¸€å€‹æ•´é«”çš„å ±å‘Š\n{{ $json.final_prompt }}\nå ±å‘Šè¦å‰‡åƒè€ƒä»¥ä¸‹\nYou are a Nutrition Vision Assistant. Think like a food scientist and registered dietitian. Reason silently and do not reveal your steps. From a single food photo, identify the meal components, estimate portion weight in grams per component using geometric/visual cues, then compute total calories, protein, carbs, and fat.\n\nEstimation method (internal only; do not output these steps)\n\nIdentify components: list the main foods (e.g., chicken breast, white rice, mixed salad, sauce).\n\nChoose references: map each component to a standard reference food.\n\nEstimate volume/size: use visible objects for scale (plate â‰ˆ 27 cm diameter, fork tines â‰ˆ 3.5 cm, spoon bowl â‰ˆ 5â€“6 cm). Approximate shapes (cuboid, cylinder, dome) to get volume in ml (â‰ˆ cmÂ³).\n\nConvert to grams (densities, g/ml): meats 1.05; cooked rice 0.66; cooked pasta 0.60; potato/solid starchy veg 0.80; leafy salad 0.15; sauces creamy 1.00; oils 0.91. If the image clearly suggests deep-fried or glossy/oily coating, account for added oil.\n\nMacros & energy per 100 g (reference values):\n\nWhite rice, cooked: 130 kcal, P 2.7, C 28, F 0.3\n\nPasta, cooked: 131 kcal, P 5.0, C 25, F 1.1\n\nChicken breast, cooked skinless: 165 kcal, P 31, C 0, F 3.6\n\nSalmon, cooked: 208 kcal, P 20, C 0, F 13\n\nLean ground beef (â‰ˆ10% fat), cooked: 217 kcal, P 26, C 0, F 12\n\nBlack beans, cooked: 132 kcal, P 8.9, C 23.7, F 0.5\n\nPotato, baked: 93 kcal, P 2.5, C 21, F 0.1\n\nLettuce/leafy salad: 15 kcal, P 1.4, C 2.9, F 0.2\n\nAvocado: 160 kcal, P 2, C 9, F 15\n\nBread (white): 265 kcal, P 9, C 49, F 3.2\n\nEgg, cooked: 155 kcal, P 13, C 1.1, F 11\n\nCheddar cheese: 403 kcal, P 25, C 1.3, F 33\n\nOlive oil: 884 kcal, P 0, C 0, F 100\n(If a food is not listed, pick the closest standard equivalent.)\n\nHidden oil & sauces: if pan-fried or visibly glossy, add ~1 tablespoon oil = 13.5 g = 120 kcal = 13.5 g fat per clearly coated serving; adjust by visual coverage.\n\nSum totals: compute grams per component Ã— (per-100 g macros/energy) and add all components.\n\nValidation: enforce Calories â‰ˆ 4Ã—Protein + 4Ã—Carbs + 9Ã—Fat. If off by >8%, adjust fat first (oil/sauce most variable), then carbs (starches), keeping protein consistent with visible lean mass.\n\nRounding: round all final totals to integers. Never output ranges or decimals.\n\nOutput rules (must follow exactly)\n\nPlain text only.\n\nUse this exact structure and field order.\n\nValues are numbers only (no units, no â€œgâ€ or â€œkcalâ€), no extra text, no JSON, no notes.\nfood name :[name]\nMeal Description: [short description]\nCalories: [number]\nProteins: [number]\nCarbs: [number]\nFat: [number]\nfood name è«‹ä½¿ç”¨ä¸­æ–‡ä¾†ç¨±å‘¼",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3104,
        1072
      ],
      "id": "cdda28b6-511c-4b3b-966b-6a8fa0037491",
      "name": "AI Agent1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "message": "={{ $json.content.parts[0].text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        3584,
        1328
      ],
      "id": "c8ac52b4-0a5a-499e-a35d-59421dccd378",
      "name": "Respond to Chat",
      "disabled": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-3-pro-preview",
        "options": {}
      },
      "id": "8aa1f475-abe6-4e3e-8062-3235fed68f77",
      "name": "Google Gemini Chat Model3",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        2880,
        1328
      ],
      "typeVersion": 1,
      "credentials": {}
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "123",
        "contextWindowLength": 4
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        4112,
        1088
      ],
      "id": "42a14fc5-7864-48c5-92e2-9bc1c57bebc5",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        2592,
        1072
      ],
      "id": "d48340b4-a7d7-4393-b950-50b1008e857e",
      "name": "Merge (Append)"
    },
    {
      "parameters": {
        "jsCode": "// è¨­å®šé–‹é ­èˆ‡çµå°¾æ–‡å­—\nlet finalString = \"\"//\"æ•´åˆä»¥ä¸‹ä¸‰å€‹è¦–è¦ºè¾¨è­˜å…§å®¹,å½™æ•´èˆ‡çµ±æ•´å¹³å‡å„è‡ªå…§å®¹.\\nç”¢å‡ºä¸€å€‹æ•´é«”çš„å ±å‘Š\\n\";\n\n// å–å¾— Merge å‚³éä¾†çš„æ‰€æœ‰è³‡æ–™\nconst items = $input.all();\n\n// å®šç¾©ä¸€å€‹å‡½æ•¸ï¼Œç”¨ä¾†è‡ªå‹•åˆ¤æ–·æ˜¯å“ªå®¶ AI çš„æ ¼å¼ä¸¦æŠ“å–æ–‡å­—\nfunction getText(item) {\n  if (!item) return \"(ç„¡è³‡æ–™)\";\n  const json = item.json;\n  \n  // æƒ…æ³ 1: Gemini (é€šå¸¸åœ¨ content.parts[0].text)\n  if (json.content && json.content.parts && json.content.parts[0]) {\n    return json.content.parts[0].text;\n  }\n  // æƒ…æ³ 2: Claude (é€šå¸¸åœ¨ content[0].text)\n  if (Array.isArray(json.content) && json.content[0]) {\n    return json.content[0].text;\n  }\n  // æƒ…æ³ 3: OpenAI (é€šå¸¸åœ¨ message.content æˆ–ç›´æ¥æ˜¯ content å­—ä¸²)\n  if (json.message && json.message.content) return json.message.content;\n  if (typeof json.content === 'string') return json.content;\n  \n  return \"(ç„¡æ³•è¾¨è­˜æ ¼å¼)\";\n}\n\n// ä¾åºæŠ“å– 3 å€‹çµæœ (å¦‚æœä¸è¶³ 3 å€‹ä¹Ÿæœƒé¡¯ç¤ºç„¡è³‡æ–™ï¼Œä¸æœƒå ±éŒ¯)\nfor (let i = 0; i < 3; i++) {\n  const text = getText(items[i]);\n  finalString += `è¦–è¦ºçµæœ${i + 1}:${text}\\n`;\n}\n\n// åŠ ä¸Šçµå°¾\n\n\n// è¼¸å‡ºçµæœ\nreturn {\n  json: {\n    final_prompt: finalString\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2832,
        1072
      ],
      "id": "27ea51e9-c7a4-46a3-872a-4a8b27cc5faf",
      "name": "Calculate Averages"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2528,
        352
      ],
      "id": "9267820c-844b-4eb7-858e-6ac8f648fab9",
      "name": "AI Agentå ±å‘Š"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "123",
        "contextWindowLength": 1
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2544,
        608
      ],
      "id": "7ec92700-435a-45ab-8a9b-e2dd29ad13a5",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2176,
        608
      ],
      "id": "3fda9495-07b5-4c3f-9d82-077e37e83ef0",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "cf5ngUevaE1Mbhl3",
          "name": "Google Gemini(PaLM) Api account 3"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 159746800,
          "mode": "list",
          "cachedResultName": "Meals",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit#gid=159746800"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "user_id",
              "lookupValue": "123"
            }
          ]
        },
        "options": {}
      },
      "id": "83128f76-b51f-4cb5-b078-44ecd3a81309",
      "name": "Get Meals Info1",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        4128,
        352
      ],
      "typeVersion": 4.7,
      "alwaysOutputData": true,
      "credentials": {}
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM",
          "mode": "list",
          "cachedResultName": "n8n_project_db",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 159746800,
          "mode": "list",
          "cachedResultName": "Meals",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-eJlsuvPjTQSupHzdhvjllyggqIAVfRQ_bL0vaGtTjM/edit#gid=159746800"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "user_id",
              "lookupValue": "=123"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        2752,
        592
      ],
      "id": "b03c61b2-aee9-4530-b514-89d4a7dc24ba",
      "name": "Get Meals Info2",
      "credentials": {}
    },
    {
      "parameters": {
        "message": "= {{ $json.output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        3168,
        336
      ],
      "id": "224212be-9f45-4d03-9c54-8d1621f460e4",
      "name": "Respond to Chat4",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}\n{{ $json.chatInput }}",
        "options": {
          "systemMessage": "=You are Cal AI ğŸ‹ï¸â€â™‚ï¸ğŸ¥¦, your friendly fitness coach and nutrition orchestrator.\nYour mission is to guide the user with motivation, clarity, and precision while managing their nutrition data. Speak in a supportive, energetic tone like a personal trainer, and use relevant emojis (ğŸ”¥ğŸ’ªğŸ¥¦ğŸ—ğŸŒ¾ğŸ¥‘) to keep the conversation fun and engaging.\n\nYou have four tools available:\n\nappendMealData(tool) â†’ store a meal row in Meals sheet.\nGet ingredients Info (tool)  â†’   search meal Ditail List ingredients\n\nupdateProfileData(tool) â†’ update the user's profile targets (fields: Name, Calories_target, Protein_target).\n\ngetUserData(tool) â†’ fetch the user's profile info.\n\ngetReport(tool) â†’ generate or fetch the daily report (requires date).\n\nğŸ”‘ Rules\n\nThe image analysis is done before reaching you. You will always receive structured info:\nFood Name[ name1,name2]\nMeal Description: [short description]\n\nCalories: [number]\nProteins: [number]\nCarbs: [number]\nFat: [number]\n\nWith this info, call Get ingredients Info to  remix and sumery taital list  ingredients \nå¿…é ˆè€ƒé‡åœ–ç‰‡é£Ÿç‰©é‡é‡èˆ‡all_nutrients_json é¡å¤–è¨ˆç®—ç”¢ç”Ÿä¸€å€‹çµ±æ•´å¿…é ˆå«æœ‰ç›¸é—œçš„æ‰€æœ‰ all_nutrients_jsonä¸¦é‡æ–°ç´€éŒ„æ–¼ all_nutrients_json  ã€‚ \n\nafter call appendMealData save  .\n\nAfter appendMealData success, confirm naturally in a coach style: repeat the meal info using emojis (ğŸ”¥ Calories, ğŸ— Protein, ğŸŒ¾ Carbs, ğŸ¥‘ Fat).\n\nEnd confirmations with a quick motivational phrase like:\n\nâ€œGreat fuel for your body ğŸ’ªğŸ”¥â€\n\nâ€œAnother step closer to your goals ğŸ¥¦ğŸ‹ï¸â€â™‚ï¸â€\n\nAlways offer short next-step options:\nğŸ‘‰ â€œView daily report ğŸ“‘â€\nğŸ‘‰ â€œAnalyze another meal ğŸ“¸â€\nğŸ‘‰ â€œView or update profile targets âš™ï¸â€\n\nğŸ”„ Profile Update Logic\n\nWhen the user wants to update their profile (Name, Calories_target, or Protein_target):\n\nFirst call getUserData to fetch current profile info.\n\nCompare the requested update with the existing values.\n\nOnly pass the changed fields to updateProfileData (never overwrite unchanged values).\n\nConfirm to the user in a friendly way, e.g.:\n\nâ€œâœ… Your Calories_target is now 2200 ğŸ”¥. Protein_target stays strong at 150 ğŸ—.â€\n\nâ€œProfile updated! Letâ€™s crush it ğŸ’ªğŸ¥¦.â€\n\nğŸ“‘ Tool Usage Rules\nGet ingredients Info (tool)  â†’   always called anytimes\n\ngetUserData â†’ always called first before updating the profile.\n\nupdateProfileData â†’ only include the fields that have changed.\n\ngetReport â†’ only pass the requested date.\n\nKeep all responses short, clear, motivational, and full of energy.\n\nğŸ“… Date: {{ $today.format('yyyy-MM-dd') }}\n\nåŸºæ–¼ä»¥ä¸Šè¦å‰‡ï¼Œæœ€çµ‚å›ç­”è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚"
        }
      },
      "id": "2b281b0a-7fbe-4489-a596-feb80da5709f",
      "name": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        4304,
        720
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "",
        "height": 528,
        "width": 1424
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2160,
        240
      ],
      "typeVersion": 1,
      "id": "b051f002-6ad8-4c05-979d-5fab2e01b23b",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "flutter å–å¾—å ±å‘Š\n",
        "height": 288,
        "width": 784
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3792,
        256
      ],
      "id": "d6d5db14-a3a0-4a7f-b1cd-0db8c32b4cdf",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "path": "e9919eb0-9661-4ca3-80da-fluterreport-input",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        3872,
        352
      ],
      "id": "f16a5eae-5526-4865-9d9f-c7175358fbfd",
      "name": "Webhook1",
      "webhookId": "e9919eb0-9661-4ca3-80da-2f1b611e98e3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3168,
        560
      ],
      "id": "7718a79e-011d-478f-b8a0-501791888850",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        2976,
        1280
      ],
      "id": "6606a95e-3134-406c-9f73-c91a0b8bc4fb",
      "name": "Anthropic Chat Model",
      "credentials": {}
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude 4 Sonnet"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        4016,
        912
      ],
      "id": "057dfc6f-6859-4b91-a23f-38cf8cf57cd3",
      "name": "Anthropic Chat Model1",
      "credentials": {}
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        5040,
        896
      ],
      "id": "ad5a573e-45f8-4894-8660-a7b574a331c6",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        2320,
        688
      ],
      "id": "79441f2d-94d5-48d9-88c3-c2ea719764b5",
      "name": "DeepSeek Chat Model",
      "credentials": {}
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "chatgpt-4o-latest",
          "mode": "list",
          "cachedResultName": "CHATGPT-4O-LATEST"
        },
        "text": "You are a Nutrition Vision Assistant. Think like a food scientist and registered dietitian. Reason silently and do not reveal your steps. From a single food photo, identify the meal components, estimate portion weight in grams per component using geometric/visual cues, then compute total calories, protein, carbs, and fat.\n\nEstimation method (internal only; do not output these steps)\n\nIdentify components: list the main foods (e.g., chicken breast, white rice, mixed salad, sauce).\n\nChoose references: map each component to a standard reference food.\n\nEstimate volume/size: use visible objects for scale (plate â‰ˆ 27 cm diameter, fork tines â‰ˆ 3.5 cm, spoon bowl â‰ˆ 5â€“6 cm). Approximate shapes (cuboid, cylinder, dome) to get volume in ml (â‰ˆ cmÂ³).\n\nConvert to grams (densities, g/ml): meats 1.05; cooked rice 0.66; cooked pasta 0.60; potato/solid starchy veg 0.80; leafy salad 0.15; sauces creamy 1.00; oils 0.91. If the image clearly suggests deep-fried or glossy/oily coating, account for added oil.\n\nMacros & energy per 100 g (reference values):\n\nWhite rice, cooked: 130 kcal, P 2.7, C 28, F 0.3\n\nPasta, cooked: 131 kcal, P 5.0, C 25, F 1.1\n\nChicken breast, cooked skinless: 165 kcal, P 31, C 0, F 3.6\n\nSalmon, cooked: 208 kcal, P 20, C 0, F 13\n\nLean ground beef (â‰ˆ10% fat), cooked: 217 kcal, P 26, C 0, F 12\n\nBlack beans, cooked: 132 kcal, P 8.9, C 23.7, F 0.5\n\nPotato, baked: 93 kcal, P 2.5, C 21, F 0.1\n\nLettuce/leafy salad: 15 kcal, P 1.4, C 2.9, F 0.2\n\nAvocado: 160 kcal, P 2, C 9, F 15\n\nBread (white): 265 kcal, P 9, C 49, F 3.2\n\nEgg, cooked: 155 kcal, P 13, C 1.1, F 11\n\nCheddar cheese: 403 kcal, P 25, C 1.3, F 33\n\nOlive oil: 884 kcal, P 0, C 0, F 100\n(If a food is not listed, pick the closest standard equivalent.)\n\nHidden oil & sauces: if pan-fried or visibly glossy, add ~1 tablespoon oil = 13.5 g = 120 kcal = 13.5 g fat per clearly coated serving; adjust by visual coverage.\n\nSum totals: compute grams per component Ã— (per-100 g macros/energy) and add all components.\n\nValidation: enforce Calories â‰ˆ 4Ã—Protein + 4Ã—Carbs + 9Ã—Fat. If off by >8%, adjust fat first (oil/sauce most variable), then carbs (starches), keeping protein consistent with visible lean mass.\n\nRounding: round all final totals to integers. Never output ranges or decimals.\n\nOutput rules (must follow exactly)\n\nPlain text only.\n\nUse this exact structure and field order.\n\nValues are numbers only (no units, no â€œgâ€ or â€œkcalâ€), no extra text, no JSON, no notes.\nfood name :[name]\nMeal Description: [short description]\nCalories: [number]\nProteins: [number]\nCarbs: [number]\nFat: [number]\nfood name è«‹ä½¿ç”¨ä¸­æ–‡ä¾†ç¨±å‘¼",
        "inputType": "base64",
        "binaryPropertyName": "files",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2240,
        1072
      ],
      "id": "bfc7caca-8bb1-4729-bbfb-b856dc5265a6",
      "name": "Analyze image1",
      "credentials": {}
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        4368,
        336
      ],
      "id": "70a0e1b2-4c40-4cba-908b-e889694cb31b",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2352,
        528
      ],
      "id": "59085acb-503e-4f44-9924-3bfa213570d8",
      "name": "OpenAI Chat Model",
      "credentials": {}
    }
  ],
  "connections": {
    "Input Message Router1": {
      "main": [
        [
          {
            "node": "Analyze image",
            "type": "main",
            "index": 0
          },
          {
            "node": "Analyze image1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Analyze image2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agentå ±å‘Š",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Analyze image": {
      "main": [
        [
          {
            "node": "Merge (Append)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Update Profile Data": {
      "ai_tool": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Profile Data": {
      "ai_tool": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Report": {
      "ai_tool": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Append Meal Data": {
      "ai_tool": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Input Message Router1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Chat2": {
      "main": [
        []
      ]
    },
    "Get ingredients Info": {
      "ai_tool": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Input Message Router1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image2": {
      "main": [
        [
          {
            "node": "Merge (Append)",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Respond to Chat",
            "type": "main",
            "index": 0
          },
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        []
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Merge (Append)": {
      "main": [
        [
          {
            "node": "Calculate Averages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Averages": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agentå ±å‘Š": {
      "main": [
        [
          {
            "node": "Respond to Chat4",
            "type": "main",
            "index": 0
          },
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "AI Agentå ±å‘Š",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        []
      ]
    },
    "Get Meals Info1": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Meals Info2": {
      "ai_tool": [
        [
          {
            "node": "AI Agentå ±å‘Š",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹": {
      "main": [
        [
          {
            "node": "Respond to Chat2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Get Meals Info1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Cal IA Agent å„²å­˜ä¸¦åŒæ™‚å ±å‘Šç´€éŒ„å…§å®¹",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Analyze image1": {
      "main": [
        [
          {
            "node": "Merge (Append)",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agentå ±å‘Š",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "d8b87287ac0ac42a553ec94f0aa3881c9bce7e5991b6f22ec07c4d8e2b78ce6a"
  }
}